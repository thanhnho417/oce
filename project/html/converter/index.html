<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trình chuyển đổi file</title>
    <link rel="icon" type="image/x-icon" href="/web.jpg">
    <link rel="stylesheet" href="/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Comfortaa:wght@300..700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <script src="/script.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand Regular';
        }

        .converter_selector {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid black;
            padding: 20px 10%;
            gap: 20px;
        }

        .converter_select_title {
            font-family: 'Quicksand Bold';
            width: 185px;
        }

        .converter_select {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            border-radius: 10px;
            gap: 20px;
            overflow-x: auto;
            max-width: 100%;
            scrollbar-width: thin;
            -webkit-overflow-scrolling: touch;
        }

        .converter_select_objects {
            aspect-ratio: 16/9;
            height: 100px;
            cursor: pointer;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.2s ease-in-out;
            overflow-x: auto;
            flex: 0 0 auto;
        }

        .converter_select_objects:hover {
            border-radius: 10px;
            color: white;
            background-color: rgb(62, 151, 91);
        }

        .file_converter_selected {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid black;
            padding: 20px 10%;
            gap: 20px;
        }

        .converter_select_function:hover {
            border-radius: 10px;
            color: white;
            background-color: rgb(62, 151, 91);
        }

        .file_converter_option {
            display: none;
            justify-content: flex-start;
            align-items: center;
            gap: 20px;
            overflow-x: auto;
            max-width: 100%;
            scrollbar-width: thin;
        }

        .file_converter_select_option {
            display: flex;
            justify-content: flex-start;
            border-radius: 10px;
            align-items: center;
            gap: 20px;
            overflow-x: auto;
            max-width: 100%;
            scrollbar-width: thin;
            -webkit-overflow-scrolling: touch;
        }

        .converter_select_function {
            aspect-ratio: 16/9;
            height: 100px;
            cursor: pointer;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.2s ease-in-out;
            flex: 0 0 auto;
        }

        .media_convert_container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            width: fit-content;
            margin: 0 auto;
            background-color: #14201e;
            color: white;
            border-radius: 10px;
        }

        .media_convert_main {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .media_convert_main_func {
            display: flex;
            justify-content: end;
            align-items: center;
            gap: 10px;
            margin: 5px 30px;
        }

        .media_convert_input {
            flex: 0 0 auto;
            text-align: center;
            color: black;
        }

        .media_convert_input>label {
            display: inline-block;
            margin: 10px;
            border-radius: 5px;
            padding: 80px 180px;
            cursor: pointer;
            background-color: rgb(238, 238, 238);
        }

        .media_convert_container>button {
            font: inherit;
            appearance: none;
            padding: 10px 20px;
            background-color: #43448f;
            color: white;
            border: 2px solid black;
            margin: 0 10px 10px 10px;
            border-radius: 5px;
        }

        .media_convert_main_title {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 10px 10px 0 30px;
            font-family: 'Quicksand Bold';
            text-align: left;
            width: 100%;
        }

        .file_type {
            padding: 0 20px 10px 20px;
            display: inline-block;
            justify-content: flex-start;
            align-items: center;
        }

        .media_format_func {
            display: flex;
            justify-content: space-between;
            width: 100%;
            align-items: center;
            gap: 20px;
            padding: 0 15px 10px 15px;
        }

        .media_format_select {
            flex: 1;
            appearance: none;
            padding: 10px 10px;
            font-family: 'Quicksand Regular';
            cursor: pointer;
            background-color: white;
            color: black;
            border-radius: 5px;
            font-size: 14px;
        }

        .media_status {
            width: 100%;
            text-align: start;
            padding: 5px 15px;
            background-color: rgb(82, 82, 82);
            border-radius: 0 0 5px 5px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>

<body>
    <header></header>
    <div class="navigation">
        <a href="/"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                fill="#e8eaed">
                <path
                    d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z" />
            </svg></a>
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
            <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" />
        </svg>
        <a href="/project">Project</a>
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
            <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" />
        </svg>
        <a href="/project/html">Html</a>
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
            <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" />
        </svg>
        <a href="/project/html/converter/">Trình chuyển đổi file</a>
    </div>
    <div class="converter_selector">
        <div class="converter_select_title">
            Chọn loại bạn muốn chuyển đổi
        </div>
        <div class="converter_select">
            <div id="convert_image" data-target="image_converter" class="converter_select_objects">Hình ảnh</div>
            <div id="convert_document" data-target="document_converter" class="converter_select_objects">Tài liệu</div>
            <div id="convert_audio" data-target="audio_converter" class="converter_select_objects">Âm thanh</div>
            <div id="convert_video" data-target="video_converter" class="converter_select_objects">Video</div>
        </div>
    </div>
    <div class="file_converter_selected">
        <div class="file_converter_option" id="audio_converter">
            <div id="audio_converter_title" class="converter_select_title">
                Chọn loại chuyển đổi bạn cần
            </div>
            <div class="file_converter_select_option">
                <div id="audiotomp3" class="converter_select_function">Chuyển thành mp3</div>
                <div id="audiotoflac" class="converter_select_function">Chuyển thành flac</div>
                <div id="audiotowav" class="converter_select_function">Chuyển thành wav</div>
                <div id="audiotoogg" class="converter_select_function">Chuyển thành ogg</div>
            </div>
        </div>
        <div class="file_converter_option" id="document_converter">
            <div id="document_converter_title" class="converter_select_title">
                Chọn loại chuyển đổi bạn cần
            </div>
            <div class="file_converter_select_option">
                <div id="documenttopdf" class="converter_select_function">Chuyển thành pdf</div>
                <div id="documenttodocx" class="converter_select_function">Chuyển thành docx</div>
                <div id="documenttotxt" class="converter_select_function">Chuyển thành txt</div>
            </div>
        </div>
        <div class="file_converter_option" id="image_converter">
            <div id="image_converter_title" class="converter_select_title">
                Chọn loại chuyển đổi bạn cần
            </div>
            <div class="file_converter_select_option">
                <div id="imagetopng" class="converter_select_function">Chuyển thành png</div>
                <div id="imagetojpg" class="converter_select_function">Chuyển thành jpg</div>
                <div id="imagetobmp" class="converter_select_function">Chuyển thành bmp</div>
                <div id="imagetowebp" class="converter_select_function">Chuyển thành webp</div>
            </div>
        </div>
        <div class="file_converter_option" id="video_converter">
            <div id="video_converter_title" class="converter_select_title">
                Chọn loại chuyển đổi bạn cần
            </div>
            <div class="file_converter_select_option">
                <div id="videotomp4" class="converter_select_function">Chuyển thành mp4</div>
                <div id="videotomkv" class="converter_select_function">Chuyển thành mkv</div>
                <div id="videoto3gp" class="converter_select_function">Chuyển thành 3gp</div>
            </div>
        </div>
    </div>
    <hr>
    <form class="media_convert_container" id="media_convert">
        <div class="media_convert_main">
            <div class="media_convert_main_title">
                Trình chuyển đổi media
            </div>
            <div class="media_convert_main_func">
                <img src="/Images/svg/xmark-solid.svg" width="15px" alt="">
            </div>
        </div>

        <div class="media_convert_input">
            <label for="mediauploaded">Nhấn vào đây để tải lên</label>
            <input style="display: none;" type="file" id="mediauploaded" multiple accept=".mp3, .wav, .flac, .ogg, .mp4, .mkv, .3gv">
        </div>
        <div class="file_type" style="width: 100%; text-align: left;">

        </div>
        <div class="media_format_func">
            <label for="media_convert_selected_option">Chọn định dạng đầu ra:</label>
            <select name="media_convert_selected_option" id="media_select" class="media_format_select" required>
                <option value="" disabled selected>Chọn định dạng</option>
                <option value="mp3">MP3</option>
                <option value="flac">FLAC</option>
                <option value="wav">WAV</option>
                <option value="ogg">OGG</option>
                <option value="mp4">MP4</option>
                <option value="mkv">MKV</option>
            </select>
        </div>
        <button type="submit">Chuyển đổi</button>
        <div class="media_status">Đang tải lên...</div>
    </form>
    <script>
        const appstate = {
            currentMediaType: 'audio',
            conversationInProcess: false,
            supportedFormats: {
                audio: ['mp3', 'wav', 'flac', 'ogg'],
                video: ['mp4', 'mkv', '3gp'],
                image: ['png', 'jpg', 'bmp', 'webp'],
                document: ['pdf', 'docx', 'txt']
            },
        };
        const mediaanimated = document.querySelector('.media_status');
        function statusinfo(message, emoji) {
            if (!mediaanimated) return
            mediaanimated.innerHTML = `${emoji} ${message} `
            mediaanimated.style.display = 'block'
        }
        function hidestatus(delay = 0) {
            setTimeout(() => {
                mediaanimated.style.display = 'none';
            }, delay);
        }
        const option = document.querySelectorAll('.converter_select_objects')
        const box = document.querySelectorAll('.file_converter_option')

        option.forEach(opt => {
            opt.addEventListener('click', () => {
                const target = opt.getAttribute('data-target');
                box.forEach(box => box.style.display = 'none');
                const tarbox = document.getElementById(target);
                if (tarbox) {
                    tarbox.style.display = 'flex'
                    appstate.currentMediaType = target.replace('_converter', '');
                }
            })
        })
        document.getElementById('mediauploaded').addEventListener('change', function (e) {
            const file = e.target.files;
            const count = file.length
            const filetype = document.querySelector('.file_type')
            if (count === 0) {
                filetype.innerHTML = `Loại file: N/A`
            } else {
                const type = [];
                for (let i = 0; i < file.length; i++) {
                    const fname = file[i].name;
                    const ext = fname.includes('.') ? fname.split('.').pop().toLowerCase() : 'Không xác định';
                    if (!type.includes(ext)) {
                        type.push(ext)
                    }
                }
                filetype.innerHTML = `Loại file: ${type.join(', ')}`
            }
        })
        document.getElementById('media_convert').addEventListener('submit', async function (e) {
            e.preventDefault();
            const file = document.getElementById('mediauploaded').files;
            const format = document.getElementById('media_select').value;
            if (file.length === 0) {
                alert('Không có file chuyển đổi, vui lòng tải lên và thử lại');
                return
            }
            const formdata = new FormData();
            for (let i = 0; i < file.length; i++) {
                formdata.append('files', file[i]);
            }
            formdata.append('format', format)
            
            let typeselect = 'unknown';
            for (const[type, formatlist] of Object.entries(appstate.supportedFormats)){
                if(formatlist.includes(format.toLowerCase())){
                    typeselect = type;
                    break
                }
            }
            appstate.currentMediaType = typeselect;
            formdata.append('type', typeselect)
            try {
                statusinfo('Đang gửi lên hệ thống', '📤')
                const response = await fetch('https://file-converter-api-ugp0.onrender.com/convert', {
                    method: 'POST',
                    body: formdata
                })



                if (!response.ok) {
                    const mediaerror = await response.json();
                    statusinfo(`Lỗi gửi đi, mã lỗi: ${mediaerror.error}`, '❌')
                    return
                }
                statusinfo('Đang xử lí', '⚙️');

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.length > 1 ? 'media_converted_file.zip' : `converted.${format}`;
                a.click();
                URL.revokeObjectURL(url)
                statusinfo('Hoàn tất', '✅')
                hidestatus(4000)
            } catch (error) {
            alert(`Lỗi khi chuyển đổi: ${error.message}`)
            hidestatus(5000)
        }
            
        })
    </script>
    <footer></footer>
</body>

</html>